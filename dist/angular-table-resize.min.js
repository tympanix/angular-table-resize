angular.module("ngTableResize",[]),angular.module("ngTableResize").directive("resizable",["resizeStorage","$injector",function(t,e){function n(){this.columns=[],this.isFirstDrag=!0,this.resizer=s(this),console.log("Resizer",this.resizer);var e=t.loadTableSizes(this.id,this.mode,this.profile);this.addColumn=function(t){this.columns.push(t)},this.loadSavedColumns=function(){e=t.loadTableSizes(this.id,this.mode,this.profile)},this.injectResizer=function(){this.resizer&&(console.log("Tear down",this.resizer),this.resizer.tearDown());var t=s(this);null!==t&&(this.resizer=t),this.loadSavedColumns()},this.getStoredWidth=function(t){return e[t.resize]},this.initialiseColumns=function(){this.canRestoreColumns()?this.initSavedColumns():this.initDefaultColumns()},this.canRestoreColumns=function(){var t=this,n=!0;this.resizer.strictSaving===!0&&(n=Object.keys(e).length===t.columns.length);var i=this.columns.every(function(e){return t.getStoredWidth(e)||t.resizer.newColumnWidth(e)});return console.log("Strict and restore",n,i),n&&i},this.render=function(){this.resetAll(),this.initialiseAll(),this.resizer.setup(),this.initialiseColumns()},this.initSavedColumns=function(){var t=this;this.columns.forEach(function(e){e.setWidth(t.getStoredWidth(e)||t.resizer.newColumnWidth(e))}),this.resizer.onTableReady(),this.virgin=!1},this.initDefaultColumns=function(){var t=this;e={},this.columns.forEach(function(e){e.setWidth(t.resizer.defaultWidth(e))}),this.virgin=!0},this.getColumns=function(){return this.columns.map(function(t){return t.element})},this.removeColumn=function(t){var e=this.columns.indexOf(t);e>-1&&this.columns.splice(e,1),this.resetAll(),this.initialiseAll(),this.initialiseColumns()},this.deleteHandles=function(){this.columns.forEach(function(t){t.deleteHandle()})},this.resetAll=function(){this.isFirstDrag=!0,this.virgin=!0,this.deleteHandles()},this.initialiseAll=function(){this.columns.forEach(function(t){t.initialise()})},this.saveColumnSizes=function(){var n=this;e||(e={}),this.columns.forEach(function(t){e[t.resize]=n.resizer.saveAttr(t)}),t.saveTableSizes(this.id,this.mode,this.profile,e)},this.nextColumn=function(t){var e=this.columns.indexOf(t);return e===-1||e>=this.columns.length?void 0:this.columns[e+1]}}function i(t,e){return t.addClass("resize"),o}function o(t,e,n,i){i.table=$(e),i.container=i.container?$(i.container):e.parent(),r(t,i)}function r(t,e){t.$watch(function(){return e.mode},function(t){t&&(e.injectResizer(),e.render())}),t.$watch(function(){return e.profile},function(t){t&&(e.loadSavedColumns(),e.initialiseColumns())})}function s(t){try{var n=t.mode?t.mode:"BasicResizer",i=e.get(n);if(!i)return;return console.log("Settings resizer to",n),new i(t)}catch(o){return console.error("The resizer "+t.mode+" was not found"),null}}return{restrict:"A",priority:0,compile:i,controller:n,controllerAs:"rzctrl",bindToController:!0,scope:{id:"@",mode:"=?",profile:"=?",bind:"=?",container:"@?"}}}]),angular.module("ngTableResize").directive("resize",[function(){function t(){return{pre:e,post:n}}function e(t,e,n,o){t.resize=t.$eval(n.resize),t.element=e,t.deleteHandle=function(){t.handle&&t.handle.remove()},t.addHandle=function(){i(t,o,e)},t.initialise=function(){o.resizer.handles(t)&&i(t,o,e)},t.setWidth=function(t){e.css({width:t})},t.next=function(){return o.nextColumn(t)},t.getWidth=function(){return t.element.outerWidth()},t.$on("$destroy",function(){o.removeColumn(t)}),o.addColumn(t)}function n(t,e,n,i){t.$last&&(console.log("RENDER!"),i.render())}function i(t,e,n){t.handle=$("<div>",{"class":"handle"}),n.prepend(t.handle),t.controlledColumn=e.resizer.handleMiddleware(t,e.collumns),o(t,e)}function o(t,e){$(t.handle).mousedown(function(n){e.isFirstDrag&&(console.log("First drag"),e.resizer.onFirstDrag(),e.resizer.onTableReady(),e.isFirstDrag=!1,e.virgin=!1);var i={};e.resizer.intervene&&(i=e.resizer.intervene.selector(t.controlledColumn),i.column=i,i.orgWidth=i.element.outerWidth()),n.preventDefault(),$(t.handle).addClass("active"),$("body").addClass("table-resize");var o=n.clientX,l=t.getWidth();$(window).mousemove(r(t,e,o,l,i)),$(window).one("mouseup",s(t,e,t.handle))})}function r(t,e,n,i,o){return function(r){var s=r.clientX,l=s-n,u=e.resizer.calculate(i,l);if(!e.resizer.restrict(u)){if(e.resizer.intervene){var c=e.resizer.intervene.calculator(o.orgWidth,l);if(e.resizer.intervene.restrict(c))return;o.setWidth(c)}t.controlledColumn.setWidth(u)}}}function s(t,e,n){return function(){$(n).removeClass("active"),$(window).unbind("mousemove"),$("body").removeClass("table-resize"),e.resizer.onEndDrag(),e.saveColumnSizes()}}return{restrict:"A",compile:t,require:"^^resizable",scope:!1}}]),angular.module("ngTableResize").service("resizeStorage",["$window",function(t){function e(t,e,i){var o=[];return t?(o.push(n),o.push(t),o.push(e),i&&o.push(i),o.join(".")):void console.error("Table has no id",t)}var n="ngColumnResize";this.loadTableSizes=function(n,i,o){var r=e(n,i,o),s=t.localStorage.getItem(r);return JSON.parse(s)||{}},this.saveTableSizes=function(n,i,o,r){var s=e(n,i,o);if(s){var l=JSON.stringify(r);t.localStorage.setItem(s,l)}}}]),angular.module("ngTableResize").factory("ResizerModel",[function(){function t(t){this.strictSaving=!0,this.minWidth=50,this.ctrl=t}return t.prototype.setup=function(){$(this.ctrl.container).css({overflowX:"hidden"})},t.prototype.tearDown=function(){},t.prototype.defaultWidth=function(t){return"auto"},t.prototype.newColumnWidth=function(t){return!1},t.prototype.onTableReady=function(){$(this.ctrl.table).outerWidth("100%")},t.prototype.handles=function(){return!0},t.prototype.ctrlColumns=function(){return!0},t.prototype.onFirstDrag=function(){console.log("First drag",this.ctrl.columns),this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},t.prototype.handleMiddleware=function(t,e){return t},t.prototype.restrict=function(t){return t<this.minWidth},t.prototype.calculate=function(t,e){return t+e},t.prototype.onEndDrag=function(){},t.prototype.saveAttr=function(t){return t.getWidth()},t}]),angular.module("ngTableResize").factory("BasicResizer",["ResizerModel",function(t){function e(e,r,s){t.call(this,e,r,s),this.ctrlColumns=this.columns,this.intervene={selector:n,calculator:i,restrict:o}}function n(t){return t.next()}function i(t,e){return t-e}function o(t){return t<50}return e.prototype=Object.create(t.prototype),e.prototype.setup=function(t,e){console.log("Setting up basic resizer",this.ctrl.columns[0]),this.ctrl.container.css({overflowX:"hidden"}),this.ctrl.columns[0].setWidth("auto")},e.prototype.handles=function(t){return t.$last!==!0},e.prototype.onFirstDrag=function(){this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},e.prototype.onEndDrag=function(){var t=$(this.ctrl.table).outerWidth(),e=0;this.ctrl.columns.forEach(function(n){var i=n.getWidth(),o=i/t*100+"%";e+=i/t*100,n.setWidth(o)})},e.prototype.saveAttr=function(t){return $(t.element)[0].style.width},e}]),angular.module("ngTableResize").factory("FixedResizer",["ResizerModel",function(t){function e(e,n,i){t.call(this,e,n,i),this.fixedColumn=$(e).find("th").first(),this.bound=!1}return e.prototype=Object.create(t.prototype),e.prototype.setup=function(){$(this.container).css({overflowX:"hidden"}),$(this.columns).first().css({width:"auto"})},e.prototype.handles=function(){return $(this.columns).not(":last")},e.prototype.ctrlColumns=function(){return $(this.columns).not(":first")},e.prototype.onFirstDrag=function(){$(this.ctrlColumns).each(function(t,e){$(e).width($(e).width())})},e.prototype.handleMiddleware=function(t,e){return $(e).next()},e.prototype.restrict=function(t){return this.bound?!(t<this.bound)||($(this.fixedColumn).width("auto"),this.bound=!1,!1):t<this.minWidth||($(this.fixedColumn).width()<=this.minWidth?(this.bound=t,$(this.fixedColumn).width(this.minWidth),!0):void 0)},e.prototype.calculate=function(t,e){return t-e},e}]),angular.module("ngTableResize").factory("OverflowResizer",["ResizerModel",function(t){function e(e,n,i){t.call(this,e,n,i),this.strictSaving=!1}return e.prototype=Object.create(t.prototype),e.prototype.newColumnWidth=function(t){return 150},e.prototype.setup=function(){console.log("Overflow setup"),$(this.ctrl.container).css({overflow:"auto"})},e.prototype.tearDown=function(){$(this.ctrl.table).width("")},e.prototype.onTableReady=function(){console.log("Overflow table ready"),$(this.ctrl.table).width(1)},e}]);